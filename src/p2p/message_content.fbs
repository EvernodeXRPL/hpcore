//IDL file for p2p message content schema.
namespace p2p;

table BytesKeyValuePair { //flatbuff equivalent for dictionary/hashmap for <byte>
    key:[ubyte]; 
    value:[ubyte]; 
 }

 table ByteArray { //To represent list of byte arrays
     array:[ubyte];
 }

union Message { Proposal_Message, Npl_Message } //message content type

table Content { 
    message:Message;
}

table Proposal_Message { //Proposal type message schema
    pubkey:[ubyte];
    timestamp:uint64;
    stage: int8;
    time:uint64;
    lcl:[ubyte];
    users: [ByteArray];
    raw_inputs: [BytesKeyValuePair];   //stage 0 inputs 
    hash_inputs:[ByteArray];            //stage > 0 inputs (hash of stage 0 inputs)
    raw_outputs: [BytesKeyValuePair];  //stage 0 outputs 
    hash_outputs:[ByteArray];           //stage > 0 outputs (hash of stage 0 outputs)
    state: State;
}

table Npl_Message { //NPL type message schema
    pubkey:[ubyte];
    timestamp:uint64;
    data:[ubyte];
    lcl:[ubyte];
}

table StateDifference { //Represent state difference by tracking created,updated and deleted state files.
    created: [BytesKeyValuePair]; //list of { fn => hash }
    updated: [BytesKeyValuePair]; 
    deleted: [BytesKeyValuePair]; 
}

table State {
    previous: [ubyte];  // hash of the previous state
    current: [ubyte];  //  hash of the current state
    difference: StateDifference; 
    patch: [BytesKeyValuePair];   // fn -> bsdiff patch going from previous state to new state
}

root_type Content; //root type for message content